<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTale - Story Sharing App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; margin: 0; padding: 0;}
        .mobile-container { max-width: 480px; margin: 0 auto; background-color: white; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.1); position: relative; padding-bottom: 70px; display: none; overflow-x: hidden; }
        #loginScreen { max-width: 480px; margin: 0 auto; min-height: 100vh; background: linear-gradient(135deg, #4f46e5, #3b82f6); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #readingView, #authorProfileView { display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: white; z-index: 50; overflow-y: auto; padding-bottom: 80px; }
        .no-select { -webkit-user-select: none; -ms-user-select: none; user-select: none; }
        #messageBox { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #10B981; color: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 2000; display: none; transition: opacity 0.3s; text-align: center; width: 90%; max-width: 400px; font-weight: bold; }
        #notificationToast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background-color: #ffffff; border-left: 4px solid #4f46e5; padding: 12px 20px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 2500; transition: top 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); width: 90%; max-width: 400px; display: flex; align-items: center; gap: 12px; }
        #notificationToast.show { top: 20px; }
        /* ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1500; justify-content: center; align-items: center; padding: 20px; }
        .story-cover { height: 160px; background-color: #e5e7eb; background-size: cover; background-position: center; border-radius: 8px 8px 0 0; }
        .author-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: #cbd5e1; background-size: cover; background-position: center; border: 2px solid white; }
    </style>
</head>
<body>

<div id="messageBox">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</div>
<div id="notificationToast">
    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"><i class="fas fa-bell"></i></div>
    <div><h4 class="text-sm font-bold text-gray-800" id="notifTitle">‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡¶≤‡ßç‡¶™!</h4><p class="text-xs text-gray-500" id="notifDesc">‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</p></div>
</div>

<div id="loginScreen">
    <div class="bg-white p-8 rounded-2xl shadow-2xl w-full text-center">
        <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600 text-4xl"><i class="fas fa-book-reader"></i></div>
        <h1 class="text-3xl font-black text-gray-800 mb-1 tracking-tight">YouTale</h1>
        <p class="text-gray-500 mb-8 text-sm font-medium">‡¶™‡ßú‡ßÅ‡¶®, ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        
        <div class="space-y-3 mb-6">
            <button onclick="loginAs('user')" class="w-full bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-gray-50 shadow-sm"><i class="fab fa-google text-red-500"></i> ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶®</button>
            <button onclick="loginAs('guest')" class="w-full bg-indigo-50 text-indigo-700 py-3 rounded-lg font-bold hover:bg-indigo-100 border border-indigo-200"><i class="fas fa-user-secret"></i> ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶õ‡¶æ‡ßú‡¶æ ‡¶™‡ßú‡ßÅ‡¶®</button>
        </div>
        
        <div class="pt-4 border-t border-gray-200">
            <p class="text-[10px] text-gray-400 mb-2 uppercase tracking-wider font-bold">‡¶°‡ßá‡¶Æ‡ßã ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</p>
            <div class="flex flex-col gap-2">
                <button onclick="loginAs('superadmin')" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold shadow-md hover:bg-indigo-700 text-xs">üëë ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂</button>
                <button onclick="loginAs('admin')" class="w-full bg-green-500 text-white py-2.5 rounded-lg font-bold shadow-md hover:bg-green-600 text-xs">‚úçÔ∏è ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂</button>
            </div>
        </div>
    </div>
</div>

<div class="mobile-container" id="mainApp">
    <header class="bg-indigo-600 text-white p-4 sticky top-0 z-10 shadow-md">
        <div class="flex justify-between items-center mb-3">
            <h1 class="text-xl font-black tracking-tight"><i class="fas fa-book-open mr-2"></i> YouTale</h1>
            <button onclick="logout()" class="text-indigo-200 hover:text-white text-xs bg-indigo-800 px-3 py-1.5 rounded-full font-bold"><i class="fas fa-sign-out-alt mr-1"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>
        <div class="relative" id="searchContainer">
            <input type="text" id="searchInput" onkeyup="searchStories()" placeholder="‡¶ó‡¶≤‡ßç‡¶™ ‡¶¨‡¶æ ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full bg-indigo-700 text-white placeholder-indigo-300 border-none rounded-full py-2.5 px-4 pl-10 focus:outline-none text-sm shadow-inner">
            <i class="fas fa-search absolute left-3.5 top-3 text-indigo-300"></i>
        </div>
    </header>

    <main class="p-0 bg-gray-100 min-h-screen relative">
        <div id="homeTab" class="tab-content active p-4">
            <div id="guestWarning" class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4 hidden rounded shadow-sm">
                <p class="text-xs text-yellow-700 font-medium">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ó‡ßá‡¶∏‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶°‡ßá ‡¶Ü‡¶õ‡ßá‡¶®‡•§ ‡¶≤‡¶æ‡¶á‡¶ï, ‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂ ‡¶¨‡¶æ ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>
            <h2 class="font-bold text-gray-800 mb-4 text-lg border-b pb-2 border-gray-200">‡¶∏‡¶¨ ‡¶ó‡¶≤‡ßç‡¶™</h2>
            <div id="storyFeed" class="grid grid-cols-2 gap-3 pb-6"></div>
        </div>

        <div id="addStoryTab" class="tab-content p-4">
            <div id="writerApplicationArea" class="bg-white p-6 rounded-2xl border shadow-sm text-center hidden">
                <div class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-3xl mx-auto mb-4"><i class="fas fa-feather-alt"></i></div>
                <h2 class="font-bold text-xl text-gray-800 mb-2">‡¶≤‡ßá‡¶ñ‡¶ï ‡¶π‡¶§‡ßá ‡¶ö‡¶æ‡¶®?</h2>
                <p class="text-sm text-gray-500 mb-6">‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡¶ø ‡¶Æ‡ßá‡¶®‡ßá ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <button id="btnApplyAuthor" onclick="openTermsModal()" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-md hover:bg-indigo-700">‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <div id="applicationPendingMsg" class="mt-4 p-3 bg-yellow-50 rounded-xl text-sm text-yellow-700 font-bold hidden border border-yellow-200"><i class="fas fa-hourglass-half mr-1"></i> ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ‡ßü ‡¶Ü‡¶õ‡ßá‡•§</div>
            </div>

            <div id="writingArea" class="hidden">
                <h2 class="font-bold text-gray-800 mb-4 text-lg">‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡¶≤‡ßç‡¶™ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</h2>
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase">‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
                    <input type="text" id="newStoryCover" class="w-full mb-4 p-3 border rounded-xl text-sm bg-gray-50 outline-none" value="https://images.unsplash.com/photo-1519681393784-d120267933ba">
                    <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="newStoryTitle" placeholder="‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ..." class="w-full mb-4 p-3 border rounded-xl font-bold text-gray-800 outline-none">
                    <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase">‡¶™‡¶∞‡ßç‡¶¨ ‡¶¨‡¶æ ‡¶ñ‡¶£‡ßç‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <input type="text" id="newStoryChapter" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶™‡¶∞‡ßç‡¶¨-‡ßß..." class="w-full mb-4 p-3 border rounded-xl text-gray-800 outline-none text-sm">
                    <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase">‡¶Æ‡ßÇ‡¶≤ ‡¶ó‡¶≤‡ßç‡¶™ <span class="text-indigo-500 lowercase">(‡¶ï‡¶™‡¶ø-‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá)</span></label>
                    <textarea id="newStoryContent" rows="6" placeholder="‡¶ó‡¶≤‡ßç‡¶™ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®..." class="w-full mb-5 p-3 border rounded-xl text-sm text-gray-700 outline-none"></textarea>
                    <button onclick="submitStory()" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-indigo-700 active:scale-95 transition"><i class="fas fa-paper-plane mr-2"></i> ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <div id="dashboardTab" class="tab-content p-4">
            <div id="userProfileArea" class="bg-white p-5 rounded-2xl shadow-sm border mb-5 text-center hidden">
                <div class="author-avatar mx-auto mb-3 w-20 h-20 shadow-inner" id="dashAvatar"></div>
                <h3 class="font-bold text-xl text-gray-800" id="dashName">‡¶®‡¶æ‡¶Æ</h3>
                <p class="text-sm text-indigo-500 font-medium mb-1" id="dashId">@username</p>
                <span id="dashRoleBadge" class="inline-block bg-gray-100 text-gray-600 text-[10px] px-2 py-1 rounded font-bold uppercase">Role</span>
            </div>

            <div id="normalUserArea" class="hidden">
                <h3 class="font-bold text-gray-700 text-sm mb-3"><i class="far fa-bookmark text-indigo-500 mr-1"></i> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ó‡¶≤‡ßç‡¶™‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                <div id="mySavedStoriesList" class="space-y-2 mb-6"></div>
                <h3 class="font-bold text-gray-700 text-sm mb-3"><i class="fas fa-user-friends text-blue-500 mr-1"></i> ‡¶Ø‡¶æ‡¶¶‡ßá‡¶∞ ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶õ‡ßá‡¶®</h3>
                <div id="myFollowingList" class="grid grid-cols-2 gap-3 mb-6"></div>
            </div>

            <div id="authorEarningArea" class="hidden">
                <h3 class="font-bold text-gray-700 mb-3 text-sm">‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø</h3>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <div class="bg-white p-3 rounded-xl border shadow-sm text-center"><p class="text-[10px] text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶ó‡¶≤‡ßç‡¶™</p><h3 id="myTotalStories" class="text-lg font-black text-gray-800">0</h3></div>
                    <div class="bg-white p-3 rounded-xl border shadow-sm text-center"><p class="text-[10px] text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶á‡¶ï</p><h3 id="myTotalLikes" class="text-lg font-black text-gray-800">0</h3></div>
                    <div class="bg-white p-3 rounded-xl border shadow-sm text-center"><p class="text-[10px] text-gray-500">‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞</p><h3 id="myTotalFollowers" class="text-lg font-black text-gray-800">0</h3></div>
                </div>
                
                <div class="bg-gradient-to-br from-green-600 to-emerald-700 p-5 rounded-2xl shadow-lg text-white mb-6">
                    <div class="flex justify-between items-center mb-4 border-b border-green-500 pb-3">
                        <div><p class="text-[11px] text-green-100">‡¶Æ‡ßÇ‡¶≤ ‡¶Ü‡ßü (‡¶≤‡¶æ‡¶á‡¶ï+‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂)</p><h3 id="myTotalEarnings" class="text-2xl font-black">‡ß≥ 0.00</h3></div>
                        <div class="text-right"><p class="text-[10px] text-yellow-200 font-bold">‡¶°‡ßã‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶®‡ßç‡¶°</p><h3 id="myFollowerEarnings" class="text-lg font-bold text-yellow-100">‡ß≥ 0.00</h3></div>
                    </div>
                    <button onclick="toggleWithdrawForm()" class="w-full bg-white text-green-700 font-bold py-2.5 rounded-xl text-sm shadow-sm hover:bg-green-50 transition">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="withdrawFormArea" class="hidden mt-4 bg-green-800/50 p-4 rounded-xl border border-green-500 backdrop-blur-sm text-left">
                        <label class="block text-[10px] mb-1 font-bold text-green-100 uppercase tracking-wider">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</label>
                        <select id="withdrawMethod" class="w-full mb-3 p-2.5 rounded-lg text-gray-800 text-sm outline-none font-bold">
                            <option value="bKash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option><option value="Nagad">‡¶®‡¶ó‡¶¶</option><option value="Rocket">‡¶∞‡¶ï‡ßá‡¶ü</option><option value="Bank">‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</option>
                        </select>
                        <input type="text" id="withdrawAccount" placeholder="‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞..." class="w-full mb-4 p-2.5 rounded-lg text-gray-800 text-sm outline-none font-bold">
                        <button onclick="submitWithdrawRequest()" class="w-full bg-green-500 text-white font-bold py-2.5 rounded-lg hover:bg-green-400 transition shadow-md">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                    </div>
                </div>

                <h3 class="font-bold text-gray-700 text-sm mb-3">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶ó‡¶≤‡ßç‡¶™ (‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®)</h3>
                <div id="myPublishedStoriesList" class="space-y-2 mb-6"></div>

                <h3 class="font-bold text-gray-700 text-sm mb-3 flex items-center justify-between">‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü ‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶ü <span class="text-[9px] bg-red-100 text-red-600 px-2 py-0.5 rounded font-bold uppercase">‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡ßá‡¶° ‡¶è‡¶Ü‡¶á</span></h3>
                <div id="myCopyrightAlerts" class="space-y-2 mb-6"></div>
            </div>

            <div id="superAdminArea" class="hidden">
                <div class="bg-gray-800 text-white p-4 rounded-2xl shadow-lg mb-5 flex justify-between items-center">
                    <div>
                        <p class="text-xs text-gray-400 font-bold uppercase">‡ßß ‡¶≤‡¶æ‡¶á‡¶ï‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡¶ü‡¶æ‡¶ï‡¶æ)</p>
                        <div class="flex items-center gap-2 mt-1"><span class="text-gray-300">‡ß≥</span><input type="number" step="0.01" id="adminLikeRate" class="w-20 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-white outline-none font-bold"></div>
                    </div>
                    <button onclick="updateLikeRate()" class="bg-indigo-500 hover:bg-indigo-600 px-4 py-2 rounded-xl text-sm font-bold shadow-md transition">‡¶∏‡ßá‡¶≠</button>
                </div>

                <div class="bg-indigo-600 text-white p-5 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
                    <i class="fas fa-vault absolute -right-4 -bottom-4 text-6xl text-indigo-400 opacity-30"></i>
                    <h2 id="totalPlatformFunds" class="text-3xl font-black mt-1 mb-1">‡ß≥ 0.00</h2>
                    <p class="text-[11px] text-indigo-100 font-medium">‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ ‡¶´‡¶æ‡¶®‡ßç‡¶° (‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂‡ßá‡¶∞ ‡ß´‡ß¶%)</p>
                </div>
                
                <div class="bg-white border border-yellow-200 rounded-xl overflow-hidden shadow-sm mb-4">
                    <div class="bg-yellow-50 p-3 border-b border-yellow-200 flex justify-between"><h3 class="font-bold text-yellow-800 text-sm"><i class="fas fa-user-plus mr-1"></i> ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</h3><span id="reqCount" class="bg-yellow-200 text-yellow-800 text-[10px] px-2 rounded-full font-bold flex items-center">0</span></div>
                    <div id="writerAppList" class="p-2 space-y-2 bg-gray-50 max-h-40 overflow-y-auto"></div>
                </div>

                <div class="bg-white border border-red-200 rounded-xl overflow-hidden shadow-sm mb-4">
                    <div class="bg-red-50 p-3 border-b border-red-200 flex justify-between"><h3 class="font-bold text-red-800 text-sm"><i class="fas fa-eye-slash mr-1"></i> ‡¶π‡¶æ‡¶á‡¶° ‡¶π‡¶ì‡ßü‡¶æ ‡¶ó‡¶≤‡ßç‡¶™ (‡ß™‡ß¶+ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü)</h3></div>
                    <div id="hiddenStoriesList" class="p-2 space-y-2 bg-gray-50 max-h-40 overflow-y-auto"></div>
                </div>

                <div class="bg-white border border-green-200 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-green-50 p-3 border-b border-green-200 flex justify-between"><h3 class="font-bold text-green-800 text-sm"><i class="fas fa-money-check-alt mr-1"></i> ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</h3><span id="withdrawReqCount" class="bg-green-200 text-green-800 text-[10px] px-2 rounded-full font-bold flex items-center">0</span></div>
                    <div id="withdrawReqList" class="p-2 space-y-2 bg-gray-50 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="readingView">
        <div class="fixed top-0 left-0 right-0 max-w-[480px] mx-auto p-4 flex justify-between items-center z-50 bg-gradient-to-b from-black/60 to-transparent">
            <button onclick="closeReadingView()" class="bg-white/20 text-white w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md shadow-md hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
            <div class="flex gap-2">
                <button id="btnSaveStory" onclick="toggleSaveStory()" class="bg-white/20 text-white w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md shadow-lg hover:bg-white/30 transition"><i class="far fa-bookmark text-lg"></i></button>
                <button onclick="reportStory()" class="bg-red-500/90 text-white w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md shadow-lg border border-red-400 transition hover:bg-red-600"><i class="fas fa-flag"></i></button>
            </div>
        </div>
        
        <div id="readCover" class="w-full h-72 bg-gray-200 bg-cover bg-center relative"></div>
        
        <div class="px-6 -mt-12 relative z-10 bg-white rounded-t-[30px] pt-8 min-h-screen">
            <p id="readChapterBadge" class="text-[10px] bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded inline-block font-bold mb-3 hidden">‡¶™‡¶∞‡ßç‡¶¨ ‡ßß</p>
            <h1 id="readTitle" class="text-3xl font-black text-gray-900 leading-tight mb-4">‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h1>
            
            <div class="flex items-center justify-between mb-6 pb-6 border-b border-gray-100">
                <div class="flex items-center gap-3 flex-1 cursor-pointer hover:bg-gray-50 p-1 rounded-lg transition" onclick="openAuthorProfileFromRead()">
                    <div id="readAuthorAvatar" class="author-avatar w-12 h-12 shadow-md border-2 border-indigo-100"></div>
                    <div><p id="readAuthorName" class="font-bold text-sm text-gray-800">‡¶≤‡ßá‡¶ñ‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</p><p id="readAuthorFollowers" class="text-[10px] text-gray-500 font-medium">0 ‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞</p></div>
                </div>
                <div class="flex items-center gap-1">
                    <button id="btnFollow" onclick="toggleFollow()" class="bg-indigo-50 border border-indigo-200 text-indigo-600 px-4 py-1.5 rounded-full text-xs font-bold shadow-sm transition hover:bg-indigo-100">‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button id="btnBell" onclick="openBellModal()" class="hidden bg-gray-100 text-gray-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 transition"><i class="fas fa-bell"></i></button>
                </div>
                <div id="superAdminBonusTool" class="hidden flex-col items-end border-l border-gray-200 pl-3 ml-2">
                    <p class="text-[8px] text-gray-400 font-bold uppercase mb-1">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶¶‡¶ø‡¶®</p>
                    <div class="flex gap-1 mb-1"><input type="number" id="bonusLikeInput" placeholder="‡¶≤‡¶æ‡¶á‡¶ï" class="w-14 px-1.5 py-1 text-[10px] border rounded bg-gray-50 outline-none font-bold"><button onclick="giveBonusLike()" class="bg-red-500 text-white px-2 py-1 rounded text-[10px] font-bold"><i class="fas fa-heart"></i></button></div>
                    <div class="flex gap-1"><input type="number" id="bonusFollowInput" placeholder="‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞" class="w-14 px-1.5 py-1 text-[10px] border rounded bg-gray-50 outline-none font-bold"><button onclick="giveBonusFollower()" class="bg-blue-500 text-white px-2 py-1 rounded text-[10px] font-bold"><i class="fas fa-user-plus"></i></button></div>
                </div>
            </div>

            <div class="bg-yellow-50 border border-yellow-100 text-yellow-700 text-[10px] p-2.5 rounded mb-5 text-center font-bold uppercase tracking-widest opacity-80 shadow-sm"><i class="fas fa-shield-alt mr-1"></i> ‡¶ï‡¶™‡¶ø-‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü</div>
            <p id="readContent" class="text-gray-800 text-[16px] leading-[1.8] mb-10 whitespace-pre-wrap no-select" oncopy="return false" oncut="return false" oncontextmenu="return false">‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ...</p>
            <div class="h-24"></div>
        </div>

        <div class="fixed bottom-0 w-full max-w-[480px] bg-white border-t border-gray-200 p-3 flex gap-3 z-40 pb-5 shadow-[0_-10px_15px_rgba(0,0,0,0.03)]">
            <button id="btnLike" onclick="toggleLikeInRead()" class="flex-1 py-3.5 rounded-xl font-bold flex justify-center items-center gap-2 border-2 bg-gray-50 text-gray-600 transition active:scale-95"><i class="far fa-heart text-xl"></i> <span id="readLikeCount" class="text-lg">0</span></button>
            <button onclick="openTipModal()" class="flex-1 py-3.5 rounded-xl font-bold flex justify-center items-center gap-2 bg-gradient-to-r from-emerald-500 to-green-500 text-white shadow-lg shadow-green-200 transition active:scale-95"><i class="fas fa-gift text-xl"></i> ‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂ ‡¶¶‡¶ø‡¶®</button>
        </div>
    </div>

    <div id="authorProfileView">
        <div class="fixed top-0 left-0 right-0 max-w-[480px] mx-auto p-4 z-50">
            <button onclick="closeAuthorProfile()" class="bg-white/80 text-gray-800 w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md shadow-md transition hover:bg-white"><i class="fas fa-arrow-left"></i></button>
        </div>
        <div class="bg-gradient-to-b from-indigo-500 to-blue-600 pt-20 pb-8 px-6 text-center text-white rounded-b-[40px] shadow-md relative overflow-hidden">
            <div class="absolute inset-0 bg-black/10"></div>
            <div id="profAvatar" class="w-24 h-24 rounded-full mx-auto border-4 border-white shadow-xl bg-cover bg-center mb-3 relative z-10"></div>
            <h2 id="profName" class="text-2xl font-black mb-1 relative z-10">‡¶≤‡ßá‡¶ñ‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h2>
            <p id="profId" class="text-indigo-200 text-sm mb-4 font-medium relative z-10">@username</p>
            <div class="flex justify-center gap-8 relative z-10 bg-white/10 mx-auto w-max px-6 py-2 rounded-2xl backdrop-blur-sm">
                <div><h3 id="profTotalStories" class="text-xl font-bold">0</h3><p class="text-[10px] text-indigo-100 uppercase tracking-wide">‡¶ó‡¶≤‡ßç‡¶™</p></div>
                <div class="w-px h-8 bg-white/30"></div>
                <div><h3 id="profTotalFollowers" class="text-xl font-bold">0</h3><p class="text-[10px] text-indigo-100 uppercase tracking-wide">‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞</p></div>
            </div>
        </div>
        <div class="p-4 bg-gray-50 min-h-screen">
            <h3 class="font-bold text-gray-800 mb-4 border-b pb-2"><i class="fas fa-book mr-1 text-indigo-500"></i> ‡¶≤‡ßá‡¶ñ‡¶ï‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ó‡¶≤‡ßç‡¶™</h3>
            <div id="profStoriesGrid" class="grid grid-cols-2 gap-3"></div>
        </div>
    </div>

    <nav class="bg-white border-t border-gray-100 fixed bottom-0 w-full max-w-[480px] flex justify-around text-gray-400 text-[10px] font-bold py-2 z-10 pb-5 shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
        <button onclick="switchTab('homeTab')" class="flex flex-col items-center flex-1 text-indigo-600 transition" id="navHome"><i class="fas fa-compass text-xl mb-1"></i> ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßç‡¶≤‡ßã‡¶∞</button>
        <button onclick="switchTab('addStoryTab')" class="flex flex-col items-center flex-1 transition" id="navWrite"><i class="fas fa-pen-nib text-xl mb-1"></i> ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</button>
        <button onclick="switchTab('dashboardTab')" class="flex flex-col items-center flex-1 hidden transition" id="navDashboard"><i class="fas fa-user-circle text-xl mb-1"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
    </nav>
</div>

<div id="termsModal" class="modal-overlay">
    <div class="bg-white p-6 rounded-3xl w-[90%] text-center shadow-2xl relative">
        <button onclick="closeTermsModal()" class="absolute top-4 right-5 text-gray-400 bg-gray-100 w-8 h-8 rounded-full transition hover:bg-gray-200 hover:text-gray-800">&times;</button>
        <div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center text-3xl mx-auto mb-3 border-4 border-white shadow-sm"><i class="fas fa-file-contract"></i></div>
        <h3 class="text-lg font-black mb-2 text-gray-800">‡¶≤‡ßá‡¶ñ‡¶ï ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡¶ø</h3>
        <div class="text-[12px] text-gray-600 mb-5 bg-gray-50 p-4 rounded-xl text-left border border-gray-200 space-y-2 leading-relaxed">
            <p>‡ßß. ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡¶™‡¶• ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶Ø‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶¨‡¶æ ‡¶¨‡¶á ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ö‡ßÅ‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¶‡ßá‡¶¨ ‡¶®‡¶æ‡•§</p>
            <p>‡ß®. ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ú‡¶æ‡¶∞‡¶ø‡¶ú‡¶Æ ‡¶ö‡ßá‡¶ï‡¶æ‡¶∞‡ßá ‡¶ï‡¶™‡¶ø ‡¶ß‡¶∞‡¶æ ‡¶™‡ßú‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</p>
        </div>
        <label class="flex items-center justify-center gap-2 mb-5 text-sm font-bold text-indigo-700 cursor-pointer bg-indigo-50 py-2 rounded-lg"><input type="checkbox" id="agreeCheckbox" class="w-4 h-4 accent-indigo-600"> ‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶¨ ‡¶∂‡¶∞‡ßç‡¶§‡ßá ‡¶∞‡¶æ‡¶ú‡¶ø</label>
        <button onclick="submitAuthorRequest()" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-lg transition hover:bg-indigo-700 active:scale-95">‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
    </div>
</div>

<div id="editStoryModal" class="modal-overlay">
    <div class="bg-white p-6 rounded-3xl w-[95%] max-h-[90vh] overflow-y-auto shadow-2xl relative">
        <button onclick="closeEditModal()" class="absolute top-4 right-5 text-gray-400 bg-gray-100 w-8 h-8 rounded-full transition hover:bg-gray-200">&times;</button>
        <h3 class="text-xl font-black text-gray-800 mb-4 border-b pb-2"><i class="fas fa-edit text-indigo-500 mr-2"></i>‡¶ó‡¶≤‡ßç‡¶™ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <input type="hidden" id="editStoryId">
        <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase text-left tracking-wider">‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
        <input type="text" id="editStoryCover" class="w-full mb-3 p-3 border rounded-xl text-sm outline-none bg-gray-50 focus:ring-2 focus:ring-indigo-100">
        <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase text-left tracking-wider">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
        <input type="text" id="editStoryTitle" class="w-full mb-3 p-3 border rounded-xl font-bold text-gray-800 outline-none focus:ring-2 focus:ring-indigo-100">
        <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase text-left tracking-wider">‡¶™‡¶∞‡ßç‡¶¨ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
        <input type="text" id="editStoryChapter" class="w-full mb-3 p-3 border rounded-xl text-gray-800 outline-none text-sm focus:ring-2 focus:ring-indigo-100">
        <label class="block text-[11px] font-bold text-gray-400 mb-1 uppercase text-left tracking-wider">‡¶≤‡ßá‡¶ñ‡¶æ</label>
        <textarea id="editStoryContent" rows="8" class="w-full mb-5 p-3 border rounded-xl text-sm text-gray-700 outline-none focus:ring-2 focus:ring-indigo-100"></textarea>
        <button onclick="saveEditedStory()" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-indigo-700 transition active:scale-95">‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<div id="tipModal" class="modal-overlay">
    <div class="bg-white p-6 rounded-3xl w-[85%] text-center relative shadow-2xl">
        <button onclick="closeTipModal()" class="absolute top-4 right-4 text-gray-400 bg-gray-100 w-8 h-8 rounded-full transition hover:bg-gray-200">&times;</button>
        <div class="w-16 h-16 bg-green-50 text-green-500 rounded-full flex items-center justify-center text-3xl mx-auto mb-3"><i class="fas fa-hand-holding-usd"></i></div>
        <h3 class="text-xl font-black mb-1 text-gray-800">‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂ ‡¶¶‡¶ø‡¶®</h3>
        <p class="text-[10px] text-gray-500 mb-4 bg-gray-50 p-2 rounded">‡¶è‡¶á ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ <strong class="text-green-600">‡ß´‡ß¶%</strong> ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ï‡¶ø <strong class="text-indigo-600">‡ß´‡ß¶%</strong> ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡ßü‡¶®‡ßá ‡¶´‡¶æ‡¶®‡ßç‡¶°‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶¨‡ßá‡•§</p>
        <div class="grid grid-cols-3 gap-2 mb-4">
            <button onclick="selectTipAmount(10)" class="border-2 border-gray-100 py-2.5 rounded-xl font-bold text-gray-600 hover:border-green-400 hover:text-green-500 hover:bg-green-50 transition">‡ß≥ ‡ßß‡ß¶</button>
            <button onclick="selectTipAmount(50)" class="border-2 border-gray-100 py-2.5 rounded-xl font-bold text-gray-600 hover:border-green-400 hover:text-green-500 hover:bg-green-50 transition">‡ß≥ ‡ß´‡ß¶</button>
            <button onclick="selectTipAmount(100)" class="border-2 border-gray-100 py-2.5 rounded-xl font-bold text-gray-600 hover:border-green-400 hover:text-green-500 hover:bg-green-50 transition">‡ß≥ ‡ßß‡ß¶‡ß¶</button>
        </div>
        <div class="relative mb-5">
            <span class="absolute left-4 top-3.5 font-bold text-gray-400">‡ß≥</span>
            <input type="number" id="customTip" placeholder="‡¶Ö‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£..." class="w-full border-2 border-gray-100 py-3 pl-10 pr-4 rounded-xl font-bold text-lg text-gray-800 outline-none focus:border-green-400">
        </div>
        <button onclick="processTip()" class="w-full bg-green-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:bg-green-600 transition active:scale-95">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßá ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<div id="bellModal" class="modal-overlay">
    <div class="bg-white p-5 rounded-3xl w-[80%] text-center shadow-2xl relative">
        <button onclick="closeBellModal()" class="absolute top-4 right-4 text-gray-400 bg-gray-100 w-8 h-8 rounded-full transition hover:bg-gray-200">&times;</button>
        <h3 class="text-lg font-black mb-1 text-gray-800">‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç</h3>
        <p class="text-xs text-gray-500 mb-5 border-b border-gray-100 pb-4">‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ö‡¶æ‡¶®?</p>
        <div class="space-y-3">
            <button onclick="setNotificationPref('all')" id="btnNotifAll" class="w-full py-3.5 rounded-xl border-2 flex items-center gap-3 px-4 font-bold text-gray-700 hover:bg-gray-50 transition"><i class="fas fa-bell text-indigo-500 text-lg w-6"></i> ‡¶∏‡¶¨ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</button>
            <button onclick="setNotificationPref('none')" id="btnNotifNone" class="w-full py-3.5 rounded-xl border-2 flex items-center gap-3 px-4 font-bold text-gray-700 hover:bg-gray-50 transition"><i class="fas fa-bell-slash text-gray-400 text-lg w-6"></i> ‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø ‡¶®‡ßü</button>
        </div>
    </div>
</div>

<div id="plagiarismModal" class="modal-overlay">
    <div class="bg-white p-6 rounded-3xl w-[90%] text-center shadow-2xl relative">
        <button onclick="closePlagiarismModal()" class="absolute top-4 right-4 text-gray-400 bg-gray-100 w-8 h-8 rounded-full transition hover:bg-gray-200">&times;</button>
        <div class="w-14 h-14 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-2xl mx-auto mb-2"><i class="fas fa-search-minus"></i></div>
        <h3 class="text-xl font-black mb-2 text-red-600">‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ú‡¶æ‡¶∞‡¶ø‡¶ú‡¶Æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
        <p class="text-xs text-red-700 font-bold mb-4 bg-red-50 p-2.5 rounded-lg border border-red-100">‚ö†Ô∏è <span id="plagPercent">0</span>% ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá!</p>
        <div class="text-left text-xs bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-inner">
            <p class="font-bold text-gray-800 mb-2 uppercase tracking-wider text-[10px]">‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ö‡¶Ç‡¶∂ (‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü‡ßá‡¶°):</p>
            <p id="plagSnippet" class="bg-yellow-200 text-yellow-900 px-1.5 py-0.5 rounded inline leading-relaxed font-medium"></p>
        </div>
    </div>
</div>

<script>
    let currentUser = { role: null, name: '', id: '', hasLiked: [], following: [], savedStories: [], notifPrefs: {}, isApprovedAuthor: false, pendingAuthorReq: false }; 
    let currentReadingStoryId = null; let currentProfileAuthorId = null; let currentBellAuthorId = null;
    let platformTotalFunds = 150; let currentLikeRate = 0.01;

    let usersData = {
        'super_1': { role: 'superadmin', name: '‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®', username: '@admin', avatar: 'https://ui-avatars.com/api/?name=Admin&background=4f46e5&color=fff', totalLikes: 0, totalTipsGiven: 0, followers: {real:0, bonus:0} },
        'auth_test': { role: 'admin', name: '‡¶∏‡ßÅ‡¶Æ‡¶æ‡¶á‡ßü‡¶æ ‡¶Ü‡¶ï‡ßç‡¶§‡¶æ‡¶∞', username: '@sumaiya', avatar: 'https://i.pravatar.cc/150?u=sumaiya', totalLikes: 120, totalTipsGiven: 50, followers: {real:5, bonus:10} },
        'user_demo': { role: 'user', name: '‡¶≤‡¶ó‡¶ø‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞', username: '@reader01', avatar: 'https://ui-avatars.com/api/?name=User&background=cbd5e1', totalLikes: 0, totalTipsGiven: 0, followers: {real:0, bonus:0} }
    };

    let publishedStories = [
        { id: 1, title: '‡¶®‡¶ø‡¶ù‡ßÅ‡¶Æ ‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶ï‡¶æ‡¶®‡ßç‡¶®‡¶æ', chapter: '‡¶™‡¶∞‡ßç‡¶¨-‡ßß', authorId: 'auth_test', cover: 'https://images.unsplash.com/photo-1518599904199-0ca897819ddb?w=400', content: '‡¶∞‡¶æ‡¶§ ‡¶§‡¶ñ‡¶® ‡¶†‡¶ø‡¶ï ‡ß®‡¶ü‡¶æ‡•§ ‡¶π‡¶†‡¶æ‡ßé ‡¶õ‡¶æ‡¶¶ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßÅ‡¶™‡ßÅ‡¶∞ ‡¶™‡ßú‡¶æ‡¶∞ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶Ü‡¶∏‡¶§‡ßá ‡¶≤‡¶æ‡¶ó‡¶≤‡ßã‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶æ ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶∂‡ßÅ‡ßü‡ßá ‡¶õ‡¶ø‡¶≤‡¶æ‡¶Æ‡•§ ‡¶≠‡ßü‡ßá ‡¶∂‡¶∞‡ßÄ‡¶∞ ‡¶†‡¶æ‡¶®‡ßç‡¶°‡¶æ ‡¶π‡ßü‡ßá ‡¶Ü‡¶∏‡¶õ‡¶ø‡¶≤...', likes: 120, reports: 0, status: 'published', plagReport: null },
        { id: 2, title: '‡¶Ö‡¶ö‡ßá‡¶®‡¶æ ‡¶Ü‡¶ï‡¶æ‡¶∂ (‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶°‡ßá‡¶Æ‡ßã)', chapter: '', authorId: 'auth_test', cover: 'https://images.unsplash.com/photo-1499346030926-9a72daac6c63?w=400', content: '‡¶Ü‡¶ú ‡¶Ü‡¶ï‡¶æ‡¶∂‡¶ü‡¶æ ‡¶¨‡ßú‡¶á ‡¶Ö‡¶¶‡ßç‡¶≠‡ßÅ‡¶§ ‡¶≤‡¶æ‡¶ó‡¶õ‡ßá‡•§ ‡¶Æ‡ßá‡¶ò‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶¨ ‡¶≤‡¶æ‡¶≤ ‡¶π‡ßü‡ßá ‡¶Ü‡¶õ‡ßá‡•§ ‡¶∏‡ßÅ‡¶Æ‡¶æ‡¶á‡ßü‡¶æ ‡¶ú‡¶æ‡¶®‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶¨‡¶∏‡ßá ‡¶è‡¶∏‡¶¨ ‡¶≠‡¶æ‡¶¨‡¶õ‡¶ø‡¶≤‡•§ ‡¶è‡¶Æ‡¶® ‡¶∏‡¶Æ‡ßü ‡¶§‡¶æ‡¶∞ ‡¶´‡ßã‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ü‡¶∏‡¶≤‡ßã‡•§', likes: 45, reports: 0, status: 'published', plagReport: { percent: 85, snippet: '‡¶Ü‡¶ú ‡¶Ü‡¶ï‡¶æ‡¶∂‡¶ü‡¶æ ‡¶¨‡ßú‡¶á ‡¶Ö‡¶¶‡ßç‡¶≠‡ßÅ‡¶§ ‡¶≤‡¶æ‡¶ó‡¶õ‡ßá‡•§ ‡¶Æ‡ßá‡¶ò‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶¨ ‡¶≤‡¶æ‡¶≤ ‡¶π‡ßü‡ßá ‡¶Ü‡¶õ‡ßá‡•§' } }
    ];
    
    let pendingAuthorRequests = [];
    let withdrawRequests = []; 

    document.getElementById('adminLikeRate').value = currentLikeRate;

    function loginAs(role) {
        document.getElementById('loginScreen').style.display = 'none'; document.getElementById('mainApp').style.display = 'block';
        if(!currentUser.hasLiked) currentUser.hasLiked = []; if(!currentUser.following) currentUser.following = []; if(!currentUser.savedStories) currentUser.savedStories = [];

        if (role === 'superadmin') { currentUser = { ...usersData['super_1'], id: 'super_1', isApprovedAuthor: true, hasLiked:[], following:[], savedStories:[], notifPrefs:{} }; } 
        else if (role === 'admin') { currentUser = { ...usersData['auth_test'], id: 'auth_test', isApprovedAuthor: true, hasLiked:[], following:[], savedStories:[], notifPrefs:{} }; } 
        else if (role === 'user') { currentUser = { ...usersData['user_demo'], id: 'user_demo', isApprovedAuthor: false, pendingAuthorReq: false, hasLiked:[], following:['auth_test'], savedStories:[], notifPrefs:{'auth_test':'all'} }; } 
        else { currentUser = { role: 'guest', name: '‡¶ó‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶ï', id: 'guest_' + Date.now(), isApprovedAuthor: false, hasLiked:[], following:[], savedStories:[], notifPrefs:{} }; }

        document.getElementById('navDashboard').style.display = (role !== 'guest') ? 'flex' : 'none';
        updateWritingTabUI(); switchTab('homeTab');
    }

    function logout() { closeReadingView(); document.getElementById('mainApp').style.display = 'none'; document.getElementById('loginScreen').style.display = 'flex'; }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('text-indigo-600'));
        if (tabId === 'homeTab') { document.getElementById('navHome').classList.add('text-indigo-600'); renderPublishedStories(publishedStories); }
        if (tabId === 'addStoryTab') { document.getElementById('navWrite').classList.add('text-indigo-600'); updateWritingTabUI(); }
        if (tabId === 'dashboardTab') { document.getElementById('navDashboard').classList.add('text-indigo-600'); renderDashboard(); }
    }

    function searchStories() {
        let q = document.getElementById('searchInput').value.toLowerCase();
        let filtered = publishedStories.filter(s => { let a = usersData[s.authorId] || {}; return s.title.toLowerCase().includes(q) || (a.name || '').toLowerCase().includes(q) || (a.username || '').toLowerCase().includes(q); });
        renderPublishedStories(filtered);
    }

    function updateWritingTabUI() {
        document.getElementById('writerApplicationArea').style.display = 'none';
        document.getElementById('writingArea').style.display = 'none';
        let btnApply = document.getElementById('btnApplyAuthor');
        let msgPending = document.getElementById('applicationPendingMsg');
        
        if (currentUser.role === 'guest') {
            document.getElementById('writerApplicationArea').style.display = 'block'; btnApply.style.display = 'none'; msgPending.style.display = 'none';
            document.getElementById('writerApplicationArea').innerHTML = `<p class="mt-10 font-bold text-gray-500">‡¶ó‡¶≤‡ßç‡¶™ ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>`;
        } else if (currentUser.isApprovedAuthor || currentUser.role === 'superadmin') {
            document.getElementById('writingArea').style.display = 'block';
        } else if (currentUser.pendingAuthorReq) {
            document.getElementById('writerApplicationArea').style.display = 'block'; btnApply.style.display = 'none'; msgPending.style.display = 'block';
        } else {
            document.getElementById('writerApplicationArea').style.display = 'block'; btnApply.style.display = 'block'; msgPending.style.display = 'none';
        }
    }

    // Modal Control Logic - (FIXED)
    function openTermsModal() { document.getElementById('agreeCheckbox').checked = false; document.getElementById('termsModal').style.display = 'flex'; }
    function closeTermsModal() { document.getElementById('termsModal').style.display = 'none'; }
    
    function submitAuthorRequest() {
        if(!document.getElementById('agreeCheckbox').checked) return showMessage('‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡¶ø‡¶§‡ßá ‡¶∞‡¶æ‡¶ú‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
        pendingAuthorRequests.push({ id: 'req_'+currentUser.id, userId: currentUser.id, name: currentUser.name });
        currentUser.pendingAuthorReq = true; closeTermsModal(); updateWritingTabUI(); showMessage('‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    function submitStory() {
        let title = document.getElementById('newStoryTitle').value;
        let chapter = document.getElementById('newStoryChapter').value;
        let content = document.getElementById('newStoryContent').value;
        let cover = document.getElementById('newStoryCover').value;
        if(!title || !content) return showMessage('‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶¶‡¶ø‡¶®');

        let plagReport = content.includes('‡¶ï‡¶™‡¶ø') ? { percent: 92, snippet: content.substring(0, 40) + "..." } : null;
        let newStory = { id: Date.now(), title, chapter, authorId: currentUser.id, cover, content, likes: 0, reports: 0, status: 'published', plagReport };

        publishedStories.unshift(newStory); showMessage('‡¶ó‡¶≤‡ßç‡¶™ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        if(currentUser.role === 'admin' && currentUser.id === 'auth_test') { showNotificationToast('‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡¶≤‡ßç‡¶™!', `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶æ ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ó‡¶≤‡ßç‡¶™ ‡¶õ‡ßá‡ßú‡ßá‡¶õ‡ßá‡¶®‡•§`); }

        document.getElementById('newStoryTitle').value = ''; document.getElementById('newStoryChapter').value = ''; document.getElementById('newStoryContent').value = '';
        switchTab('homeTab');
    }

    function renderDashboard() {
        document.getElementById('userProfileArea').style.display = 'block';
        document.getElementById('normalUserArea').style.display = 'none';
        document.getElementById('authorEarningArea').style.display = 'none';
        document.getElementById('superAdminArea').style.display = 'none';

        document.getElementById('dashName').innerText = currentUser.name; document.getElementById('dashId').innerText = currentUser.username || '@guest';
        document.getElementById('dashAvatar').style.backgroundImage = `url('${currentUser.avatar || 'https://ui-avatars.com/api/?name=User'}')`;
        document.getElementById('dashRoleBadge').innerText = currentUser.role === 'admin' ? '‡¶≤‡ßá‡¶ñ‡¶ï' : (currentUser.role === 'superadmin' ? '‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : '‡¶™‡¶æ‡¶†‡¶ï');

        if (currentUser.role === 'user' || currentUser.role === 'admin') {
            document.getElementById('normalUserArea').style.display = 'block';
            let saveList = document.getElementById('mySavedStoriesList'); saveList.innerHTML = '';
            let saved = publishedStories.filter(s => currentUser.savedStories.includes(s.id));
            if(saved.length===0) saveList.innerHTML = '<p class="text-xs text-gray-400 bg-gray-50 p-3 rounded-lg text-center">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ó‡¶≤‡ßç‡¶™ ‡¶®‡ßá‡¶á</p>';
            saved.forEach(s => { saveList.innerHTML += `<div onclick="openReadingView(${s.id})" class="bg-white p-2.5 rounded-xl border shadow-sm flex items-center gap-3 mb-2 cursor-pointer hover:bg-gray-50 transition"><div class="w-12 h-12 rounded-lg bg-cover" style="background-image:url('${s.cover}')"></div><div><h4 class="font-bold text-gray-800 text-sm">${s.title}</h4></div></div>`; });

            let folList = document.getElementById('myFollowingList'); folList.innerHTML = '';
            if(currentUser.following.length === 0) folList.innerHTML = '<p class="text-xs text-gray-400 col-span-2 bg-gray-50 p-3 rounded-lg text-center">‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø</p>';
            currentUser.following.forEach(id => {
                let author = usersData[id]; if(!author) return;
                folList.innerHTML += `<div onclick="openAuthorProfile('${id}')" class="bg-white p-3 rounded-xl border shadow-sm text-center cursor-pointer hover:bg-gray-50 transition"><div class="w-10 h-10 rounded-full bg-cover mx-auto mb-1.5 border-2 border-indigo-50" style="background-image:url('${author.avatar}')"></div><h4 class="font-bold text-gray-800 text-xs truncate">${author.name}</h4></div>`;
            });
        }

        if (currentUser.role === 'admin') {
            document.getElementById('authorEarningArea').style.display = 'block';
            let myData = usersData[currentUser.id]; let myStories = publishedStories.filter(s => s.authorId === currentUser.id);
            document.getElementById('myTotalStories').innerText = myStories.length;
            document.getElementById('myTotalLikes').innerText = myData.totalLikes;
            document.getElementById('myTotalFollowers').innerText = myData.followers.real + myData.followers.bonus;
            document.getElementById('myTotalEarnings').innerText = `‡ß≥ ${((myData.totalLikes * currentLikeRate) + myData.totalTipsGiven).toFixed(2)}`;
            document.getElementById('myFollowerEarnings').innerText = `‡ß≥ ${(myData.followers.real + myData.followers.bonus).toFixed(2)}`;

            let editList = document.getElementById('myPublishedStoriesList'); editList.innerHTML = '';
            myStories.forEach(s => { editList.innerHTML += `<div class="bg-white p-2.5 rounded-xl border shadow-sm flex justify-between items-center mb-2"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-lg bg-cover" style="background-image:url('${s.cover}')"></div><div><h4 class="font-bold text-gray-800 text-sm">${s.title}</h4></div></div><button onclick="openEditModal(${s.id})" class="bg-indigo-50 text-indigo-600 w-8 h-8 rounded-full flex justify-center items-center hover:bg-indigo-100 transition"><i class="fas fa-pencil-alt"></i></button></div>`; });

            let alertList = document.getElementById('myCopyrightAlerts'); alertList.innerHTML = '';
            let plagStories = myStories.filter(s => s.plagReport !== null);
            if(plagStories.length === 0) alertList.innerHTML = '<p class="text-[11px] text-gray-400 bg-gray-50 p-3 rounded-lg text-center font-medium">‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü ‡¶á‡¶∏‡ßç‡¶Ø‡ßÅ ‡¶®‡ßá‡¶á</p>';
            plagStories.forEach(s => { alertList.innerHTML += `<div class="bg-red-50 p-3 rounded-xl border border-red-200 shadow-sm flex justify-between items-center mb-2 cursor-pointer hover:bg-red-100 transition" onclick="openPlagiarismModal(${s.id})"><div><p class="font-bold text-red-800 text-xs">${s.title}</p><p class="text-[10px] text-red-600 mt-0.5">‚ö†Ô∏è ${s.plagReport.percent}% ‡¶ï‡¶™‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá</p></div><i class="fas fa-chevron-right text-red-400 text-xs"></i></div>`; });
        } 
        else if (currentUser.role === 'superadmin') {
            document.getElementById('userProfileArea').style.display = 'none'; document.getElementById('normalUserArea').style.display = 'none'; document.getElementById('superAdminArea').style.display = 'block';
            document.getElementById('totalPlatformFunds').innerText = `‡ß≥ ${platformTotalFunds.toFixed(2)}`;
            document.getElementById('reqCount').innerText = pendingAuthorRequests.length;
            
            let appList = document.getElementById('writerAppList'); appList.innerHTML = '';
            if(pendingAuthorRequests.length === 0) appList.innerHTML = '<p class="text-[11px] text-gray-400 p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶®‡ßá‡¶á</p>';
            pendingAuthorRequests.forEach((req, i) => { appList.innerHTML += `<div class="bg-white p-2.5 rounded-lg border flex justify-between items-center text-xs shadow-sm"><span><i class="fas fa-user-circle text-gray-400 mr-1"></i> ${req.name}</span><button onclick="approveAuthor(${i})" class="bg-indigo-600 text-white px-3 py-1.5 rounded font-bold shadow-sm">Approve</button></div>`; });

            let hiddenList = document.getElementById('hiddenStoriesList'); hiddenList.innerHTML = '';
            let hiddenStories = publishedStories.filter(s => s.reports >= 40 || s.status === 'hidden');
            if(hiddenStories.length === 0) hiddenList.innerHTML = '<p class="text-[11px] text-gray-400 p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶æ‡¶á‡¶° ‡¶π‡¶ì‡ßü‡¶æ ‡¶ó‡¶≤‡ßç‡¶™ ‡¶®‡ßá‡¶á</p>';
            hiddenStories.forEach((s) => { hiddenList.innerHTML += `<div class="bg-red-50 p-2.5 rounded-lg border border-red-200 flex flex-col gap-2 text-xs shadow-sm"><div class="font-bold text-red-800">${s.title} (${s.reports} ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü)</div><button onclick="republishStory(${s.id})" class="bg-green-500 text-white py-1.5 rounded font-bold shadow-sm">‡¶∞‡¶ø‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>`; });

            let wList = document.getElementById('withdrawReqList'); wList.innerHTML = '';
            document.getElementById('withdrawReqCount').innerText = withdrawRequests.length;
            if(withdrawRequests.length===0) wList.innerHTML = '<p class="text-[11px] text-gray-400 p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>';
            withdrawRequests.forEach((req, i) => { wList.innerHTML += `<div class="bg-white p-3 rounded-xl border shadow-sm text-xs"><div class="flex justify-between font-bold mb-1"><span class="text-gray-800">${req.authorName}</span><span class="text-green-600 text-sm">‡ß≥${req.amount.toFixed(2)}</span></div><p class="text-gray-500 mb-2">‡¶Æ‡ßá‡¶•‡¶°: ${req.method} | ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span class="font-mono bg-gray-100 px-1 rounded">${req.account}</span></p><button onclick="approveWithdraw(${i})" class="w-full bg-green-500 text-white py-2 rounded-lg font-bold shadow-sm transition hover:bg-green-600">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>`; });
        }
    }

    function openEditModal(id) {
        let story = publishedStories.find(s => s.id === id);
        document.getElementById('editStoryId').value = story.id; document.getElementById('editStoryCover').value = story.cover; document.getElementById('editStoryTitle').value = story.title; document.getElementById('editStoryChapter').value = story.chapter || ''; document.getElementById('editStoryContent').value = story.content;
        document.getElementById('editStoryModal').style.display = 'flex';
    }
    function closeEditModal() { document.getElementById('editStoryModal').style.display = 'none'; }
    function saveEditedStory() {
        let id = parseInt(document.getElementById('editStoryId').value); let story = publishedStories.find(s => s.id === id);
        story.title = document.getElementById('editStoryTitle').value; story.cover = document.getElementById('editStoryCover').value; story.chapter = document.getElementById('editStoryChapter').value; story.content = document.getElementById('editStoryContent').value;
        closeEditModal(); renderDashboard(); showMessage('‡¶ó‡¶≤‡ßç‡¶™ ‡¶è‡¶°‡¶ø‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
    }

    function toggleWithdrawForm() { let f = document.getElementById('withdrawFormArea'); f.style.display = f.style.display === 'block' ? 'none' : 'block'; }
    function submitWithdrawRequest() {
        let method = document.getElementById('withdrawMethod').value; let account = document.getElementById('withdrawAccount').value;
        if(!account) return showMessage('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®');
        let myData = usersData[currentUser.id]; let mainTotal = (myData.totalLikes * currentLikeRate) + myData.totalTipsGiven;
        if(mainTotal <= 0) return showMessage('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!');
        withdrawRequests.push({ authorId: currentUser.id, authorName: currentUser.name, amount: mainTotal, method, account });
        showMessage('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); toggleWithdrawForm(); document.getElementById('withdrawAccount').value = '';
        renderDashboard();
    }
    
    function updateLikeRate() { let val = parseFloat(document.getElementById('adminLikeRate').value); if(!isNaN(val) && val > 0) { currentLikeRate = val; showMessage('‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); renderDashboard(); } }
    function approveAuthor(i) { let req = pendingAuthorRequests[i]; usersData[req.userId].role = 'admin'; usersData[req.userId].username = '@writer_'+Math.floor(Math.random()*1000); pendingAuthorRequests.splice(i, 1); if(currentUser.id === req.userId) { currentUser.isApprovedAuthor = true; currentUser.role = 'admin'; } renderDashboard(); showMessage('‡¶≤‡ßá‡¶ñ‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }
    function republishStory(id) { let s = publishedStories.find(st => st.id === id); s.status = 'published'; s.reports = 0; renderDashboard(); showMessage('‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }
    function approveWithdraw(index) { let req = withdrawRequests[index]; usersData[req.authorId].totalLikes = 0; usersData[req.authorId].totalTipsGiven = 0; platformTotalFunds -= req.amount; withdrawRequests.splice(index, 1); renderDashboard(); showMessage('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }

    function renderPublishedStories(list) {
        const feed = document.getElementById('storyFeed'); feed.innerHTML = '';
        let visible = list.filter(s => s.status === 'published' && s.reports < 40);
        let followed = []; let others = [];
        visible.forEach(s => { if(currentUser.following.includes(s.authorId) && followed.length < 2) followed.push(s); else others.push(s); });
        let sorted = [...followed, ...others];
        if(sorted.length === 0) feed.innerHTML = '<div class="col-span-2 text-center text-gray-400 py-10">‡¶ó‡¶≤‡ßç‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</div>';
        sorted.forEach(story => {
            let author = usersData[story.authorId] || {}; let isFol = currentUser.following.includes(story.authorId);
            let badge = isFol ? `<span class="absolute top-2 left-2 bg-indigo-500/90 backdrop-blur-sm text-white text-[9px] px-2 py-0.5 rounded shadow-sm font-bold"><i class="fas fa-star mr-1"></i>‡¶´‡¶≤‡ßã‡ßü‡¶ø‡¶Ç</span>` : '';
            let card = document.createElement('div'); card.className = 'bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden relative cursor-pointer hover:shadow-md transition'; card.onclick = () => openReadingView(story.id);
            card.innerHTML = `${badge}<div class="story-cover" style="background-image: url('${story.cover}');"></div><div class="p-3">${story.chapter ? `<span class="text-[9px] bg-indigo-100 text-indigo-700 px-1.5 py-0.5 rounded font-bold mb-1 inline-block">${story.chapter}</span>` : ''}<h3 class="font-bold text-[14px] text-gray-800 line-clamp-2 leading-tight mb-1">${story.title}</h3><div class="flex items-center gap-1.5 mt-2"><div class="w-5 h-5 rounded-full bg-cover border border-gray-200" style="background-image: url('${author.avatar}');"></div><p class="text-[10px] text-gray-500 font-medium truncate">${author.name}</p></div></div>`;
            feed.appendChild(card);
        });
    }

    function openReadingView(id) {
        currentReadingStoryId = id; let story = publishedStories.find(s => s.id === id); let author = usersData[story.authorId] || {};
        document.getElementById('readCover').style.backgroundImage = `url('${story.cover}')`; document.getElementById('readTitle').innerText = story.title;
        if(story.chapter) { document.getElementById('readChapterBadge').innerText = story.chapter; document.getElementById('readChapterBadge').style.display = 'inline-block'; } else { document.getElementById('readChapterBadge').style.display = 'none'; }
        document.getElementById('readContent').innerText = story.content; document.getElementById('readAuthorName').innerText = author.name; document.getElementById('readAuthorAvatar').style.backgroundImage = `url('${author.avatar}')`;
        updateLikeBtnUI(story.id); updateSaveBtnUI(story.id); updateFollowBtnUI(story.authorId);
        document.getElementById('superAdminBonusTool').style.display = (currentUser.role === 'superadmin') ? 'flex' : 'none';
        document.getElementById('readingView').style.display = 'block';
    }
    function closeReadingView() { document.getElementById('readingView').style.display = 'none'; currentReadingStoryId = null; renderPublishedStories(publishedStories); }

    function openAuthorProfileFromRead() { if(!currentReadingStoryId) return; let story = publishedStories.find(s => s.id === currentReadingStoryId); openAuthorProfile(story.authorId); }
    function openAuthorProfile(authorId) {
        currentProfileAuthorId = authorId; let author = usersData[authorId]; let stories = publishedStories.filter(s => s.authorId === authorId && s.status === 'published');
        document.getElementById('profAvatar').style.backgroundImage = `url('${author.avatar}')`; document.getElementById('profName').innerText = author.name; document.getElementById('profId').innerText = author.username; document.getElementById('profTotalStories').innerText = stories.length; document.getElementById('profTotalFollowers').innerText = author.followers.real + author.followers.bonus;
        const grid = document.getElementById('profStoriesGrid'); grid.innerHTML = '';
        stories.forEach(s => { grid.innerHTML += `<div onclick="closeAuthorProfile(); openReadingView(${s.id})" class="bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer border border-gray-100 hover:shadow-md transition"><div class="h-24 bg-cover bg-center" style="background-image:url('${s.cover}')"></div><div class="p-2.5"><h4 class="text-xs font-bold text-gray-800 line-clamp-2 leading-snug">${s.title}</h4></div></div>`; });
        document.getElementById('authorProfileView').style.display = 'block';
    }
    function closeAuthorProfile() { document.getElementById('authorProfileView').style.display = 'none'; }

    function updateLikeBtnUI(id) {
        let btn = document.getElementById('btnLike'); document.getElementById('readLikeCount').innerText = publishedStories.find(s => s.id === id).likes;
        if (currentUser.hasLiked.includes(id)) { btn.innerHTML = '<i class="fas fa-heart text-xl text-red-500"></i> <span class="text-lg">'+document.getElementById('readLikeCount').innerText+'</span>'; btn.classList.add('text-red-500', 'bg-red-50', 'border-red-200'); btn.classList.remove('bg-gray-50', 'text-gray-600'); } 
        else { btn.innerHTML = '<i class="far fa-heart text-xl"></i> <span class="text-lg">'+document.getElementById('readLikeCount').innerText+'</span>'; btn.classList.remove('text-red-500', 'bg-red-50', 'border-red-200'); btn.classList.add('bg-gray-50', 'text-gray-600'); }
    }
    function toggleLikeInRead() {
        if(currentUser.role === 'guest') return showMessage('‡¶≤‡¶æ‡¶á‡¶ï ‡¶¶‡¶ø‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        let story = publishedStories.find(s => s.id === currentReadingStoryId); let author = usersData[story.authorId];
        if (currentUser.hasLiked.includes(story.id)) { story.likes -= 1; if(author) author.totalLikes -= 1; currentUser.hasLiked = currentUser.hasLiked.filter(id => id !== story.id); } 
        else { story.likes += 1; if(author) author.totalLikes += 1; currentUser.hasLiked.push(story.id); }
        updateLikeBtnUI(story.id);
    }

    function updateSaveBtnUI(id) { let btn = document.getElementById('btnSaveStory'); if(currentUser.savedStories.includes(id)) { btn.innerHTML = '<i class="fas fa-bookmark text-lg text-indigo-500"></i>'; btn.classList.add('bg-white'); btn.classList.remove('bg-white/20', 'text-white'); } else { btn.innerHTML = '<i class="far fa-bookmark text-lg"></i>'; btn.classList.add('bg-white/20', 'text-white'); btn.classList.remove('bg-white'); } }
    function toggleSaveStory() { if(currentUser.role === 'guest') return showMessage('‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); let id = currentReadingStoryId; if(currentUser.savedStories.includes(id)) { currentUser.savedStories = currentUser.savedStories.filter(sid => sid !== id); showMessage('‡¶∏‡ßá‡¶≠ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá'); } else { currentUser.savedStories.push(id); showMessage('‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); } updateSaveBtnUI(id); }

    function updateFollowBtnUI(authorId) {
        let author = usersData[authorId]; let btn = document.getElementById('btnFollow'); let bell = document.getElementById('btnBell');
        document.getElementById('readAuthorFollowers').innerText = `${author.followers.real + author.followers.bonus} ‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞`;
        if(currentUser.id === authorId) { btn.style.display = 'none'; bell.style.display = 'none'; return; }
        btn.style.display = 'block';
        if (currentUser.following.includes(authorId)) { btn.innerText = '‡¶´‡¶≤‡ßã‡ßü‡¶ø‡¶Ç'; btn.className = 'bg-gray-100 border border-gray-200 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold mr-2'; bell.style.display = 'flex'; let pref = currentUser.notifPrefs[authorId] || 'all'; bell.innerHTML = pref === 'all' ? '<i class="fas fa-bell text-indigo-500"></i>' : '<i class="fas fa-bell-slash text-gray-400"></i>'; } 
        else { btn.innerText = '‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßÅ‡¶®'; btn.className = 'bg-indigo-50 border border-indigo-200 text-indigo-600 px-4 py-1.5 rounded-full text-xs font-bold mr-2 hover:bg-indigo-100 transition'; bell.style.display = 'none'; }
    }
    function toggleFollow() {
        if(currentUser.role === 'guest') return showMessage('‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        let authorId = publishedStories.find(s => s.id === currentReadingStoryId).authorId; let author = usersData[authorId];
        if (currentUser.following.includes(authorId)) { author.followers.real -= 1; currentUser.following = currentUser.following.filter(id => id !== authorId); showMessage('‡¶Ü‡¶®‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá'); } 
        else { author.followers.real += 1; currentUser.following.push(authorId); currentUser.notifPrefs[authorId] = 'all'; showMessage('‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }
        updateFollowBtnUI(authorId);
    }

    function openBellModal() { if(!currentReadingStoryId) return; currentBellAuthorId = publishedStories.find(s => s.id === currentReadingStoryId).authorId; let pref = currentUser.notifPrefs[currentBellAuthorId] || 'all'; document.getElementById('btnNotifAll').className = `w-full py-3.5 rounded-xl border-2 flex items-center gap-3 px-4 font-bold transition ${pref==='all'?'border-indigo-500 bg-indigo-50 text-indigo-700':'text-gray-700 hover:bg-gray-50'}`; document.getElementById('btnNotifNone').className = `w-full py-3.5 rounded-xl border-2 flex items-center gap-3 px-4 font-bold transition ${pref==='none'?'border-gray-500 bg-gray-50 text-gray-700':'text-gray-700 hover:bg-gray-50'}`; document.getElementById('bellModal').style.display = 'flex'; }
    function closeBellModal() { document.getElementById('bellModal').style.display = 'none'; }
    function setNotificationPref(type) { currentUser.notifPrefs[currentBellAuthorId] = type; closeBellModal(); updateFollowBtnUI(currentBellAuthorId); showMessage(type === 'all' ? '‡¶∏‡¶¨ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá' : '‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶´ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá'); }

    function giveBonusLike() { let amt = parseInt(document.getElementById('bonusLikeInput').value); if(!amt) return; let story = publishedStories.find(s => s.id === currentReadingStoryId); story.likes += amt; if(usersData[story.authorId]) usersData[story.authorId].totalLikes += amt; updateLikeBtnUI(story.id); document.getElementById('bonusLikeInput').value = ''; showMessage('‡¶ó‡ßã‡¶™‡¶® ‡¶≤‡¶æ‡¶á‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }
    function giveBonusFollower() { let amt = parseInt(document.getElementById('bonusFollowInput').value); if(!amt) return; let story = publishedStories.find(s => s.id === currentReadingStoryId); if(usersData[story.authorId]) usersData[story.authorId].followers.bonus += amt; updateFollowBtnUI(story.authorId); document.getElementById('bonusFollowInput').value = ''; showMessage('‡¶ó‡ßã‡¶™‡¶® ‡¶´‡¶≤‡ßã‡ßü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }

    function reportStory() { if(!currentReadingStoryId) return; let story = publishedStories.find(s => s.id === currentReadingStoryId); story.reports += 1; if(story.reports >= 40) { story.status = 'hidden'; closeReadingView(); showMessage('‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã!'); } else { showMessage('‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); } }
    function openTipModal() { if(currentUser.role === 'guest') return showMessage('‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂ ‡¶¶‡¶ø‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); document.getElementById('customTip').value = ''; document.getElementById('tipModal').style.display='flex'; }
    function closeTipModal() { document.getElementById('tipModal').style.display='none'; }
    function selectTipAmount(amt) { document.getElementById('customTip').value = amt; }
    
    function processTip() {
        let amt = parseInt(document.getElementById('customTip').value||'50');
        if(amt <= 0) return showMessage('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£');
        let adminCut = amt * 0.5; let authorCut = amt * 0.5;
        platformTotalFunds += adminCut; 
        let story = publishedStories.find(s => s.id === currentReadingStoryId);
        if(usersData[story.authorId]) usersData[story.authorId].totalTipsGiven += authorCut; 
        closeTipModal(); showMessage(`‡ß≥${amt} ‡¶¨‡¶ñ‡¶∂‡¶ø‡¶∂ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
    }
    
    function openPlagiarismModal(id) { let story = publishedStories.find(s => s.id === id); document.getElementById('plagPercent').innerText = story.plagReport.percent; document.getElementById('plagSnippet').innerText = `"${story.plagReport.snippet}"`; document.getElementById('plagiarismModal').style.display = 'flex'; }
    function closePlagiarismModal() { document.getElementById('plagiarismModal').style.display = 'none'; }
    
    function showMessage(text) { const m = document.getElementById('messageBox'); m.innerText = text; m.style.display = 'block'; setTimeout(() => m.style.display = 'none', 3000); }
    function showNotificationToast(title, desc) { const t = document.getElementById('notificationToast'); document.getElementById('notifTitle').innerText = title; document.getElementById('notifDesc').innerText = desc; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 4000); }
</script>
</body>
</html>
```eof
