<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTale - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #0f0f0f; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            margin: 0;
            padding-bottom: 80px;
        }
        .brand-logo { font-family: 'Poppins', sans-serif; color: #ff0000; }
        .cat-pill { 
            flex: 0 0 auto; background: #272727; padding: 7px 15px; 
            border-radius: 8px; font-size: 13px; cursor: pointer; white-space: nowrap; 
        }
        .cat-pill.active { background: white; color: black; font-weight: bold; }
        .poster-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            background-color: #1a1a1a;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .video-time {
            position: absolute; bottom: 8px; right: 8px;
            background: rgba(0,0,0,0.8); padding: 2px 5px;
            border-radius: 4px; font-size: 11px; font-weight: bold;
        }
        #upload-modal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.95); z-index: 1000;
            padding: 20px; overflow-y: auto;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="fixed top-0 w-full bg-[#0f0f0f] z-50 px-4 py-3 flex justify-between items-center">
        <h1 class="text-2xl font-bold brand-logo">YouTale</h1>
        <div class="flex gap-4 items-center">
            <button onclick="toggleUpload(true)" class="bg-white/10 hover:bg-white/20 p-2 rounded-full">‚ûï</button>
            <div id="user-circle" class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-xs font-bold uppercase border border-white/20">?</div>
        </div>
    </header>

    <!-- Categories bar -->
    <div class="fixed top-[54px] w-full bg-[#0f0f0f] py-3 px-4 z-40 flex gap-3 overflow-x-auto no-scrollbar border-b border-white/5">
        <div class="cat-pill active">All</div>
        <div class="cat-pill">Trending</div>
        <div class="cat-pill">Horror</div>
        <div class="cat-pill">Islamic</div>
        <div class="cat-pill">Romance</div>
        <div class="cat-pill">Motivational</div>
    </div>

    <!-- Feed Container -->
    <main id="main-feed" class="mt-[115px] space-y-1">
        <!-- Loading State -->
        <div id="loading" class="p-20 text-center text-gray-500 font-medium">
            ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
        </div>
    </main>

    <!-- Upload Modal -->
    <div id="upload-modal">
        <div class="max-w-md mx-auto bg-[#1e1e1e] p-6 rounded-2xl mt-10 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">‡¶ó‡¶≤‡ßç‡¶™ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <button onclick="toggleUpload(false)" class="text-2xl text-gray-400">&times;</button>
            </div>
            <div class="space-y-4">
                <input type="text" id="story-title" placeholder="‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ" class="w-full bg-[#2a2a2a] p-3 rounded-xl outline-none border border-transparent focus:border-red-600">
                <input type="text" id="story-poster" placeholder="‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (URL)" class="w-full bg-[#2a2a2a] p-3 rounded-xl outline-none border border-transparent focus:border-red-600">
                <select id="story-category" class="w-full bg-[#2a2a2a] p-3 rounded-xl outline-none">
                    <option value="All">‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="Horror">Horror</option>
                    <option value="Islamic">Islamic</option>
                    <option value="Romance">Romance</option>
                </select>
                <textarea id="story-content" placeholder="‡¶™‡ßÅ‡¶∞‡ßã ‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="w-full bg-[#2a2a2a] p-3 rounded-xl h-40 outline-none border border-transparent focus:border-red-600"></textarea>
                <button id="pub-btn" onclick="handleUpload()" class="w-full bg-red-600 py-4 rounded-xl font-bold text-lg active:scale-95 transition-all">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® üöÄ</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full h-[65px] bg-[#0f0f0f] border-t border-white/10 flex justify-around items-center z-50">
        <div class="flex flex-col items-center gap-1 text-white">
            <span class="text-2xl">üè†</span>
            <span class="text-[10px] font-bold">Home</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-gray-500">
            <span class="text-2xl">üî•</span>
            <span class="text-[10px] font-bold">Shorts</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-gray-500">
            <span class="text-2xl">üìñ</span>
            <span class="text-[10px] font-bold">Library</span>
        </div>
        <div class="flex flex-col items-center gap-1 text-gray-500">
            <span class="text-2xl">üë§</span>
            <span class="text-[10px] font-bold">You</span>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB9WjFq4Ips9wMKoDmO8v2M6aZ2OxynQQo",
            authDomain: "youtale-f6845.firebaseapp.com",
            projectId: "youtale-f6845",
            storageBucket: "youtale-f6845.firebasestorage.app",
            messagingSenderId: "10854951568",
            appId: "1:10854951568:web:cffcc9813d858e130d8615"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "YouTale-V10-Final";

        // UI Functions
        window.toggleUpload = (show) => {
            document.getElementById('upload-modal').style.display = show ? 'block' : 'none';
        };

        // Load Content
        const loadFeed = () => {
            const feed = document.getElementById('main-feed');
            const storiesRef = collection(db, 'artifacts', appId, 'public', 'data', 'stories');

            onSnapshot(storiesRef, (snapshot) => {
                let html = '';
                if (snapshot.empty) {
                    // ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ø‡¶¶‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡ßá
                    html = `
                    <div class="w-full pb-4">
                        <div class="poster-container" style="background-image: url('https://images.unsplash.com/photo-1516979187457-637abb4f9353?q=80&w=1000')">
                            <div class="video-time">‡ßß‡ß¶:‡ßß‡ß´</div>
                        </div>
                        <div class="flex gap-3 p-4">
                            <div class="w-10 h-10 bg-red-600 rounded-full flex-shrink-0 flex items-center justify-center font-bold">Y</div>
                            <div>
                                <h3 class="font-bold text-[15px] leading-tight line-clamp-2">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</h3>
                                <p class="text-[12px] text-gray-400 mt-1">YouTale Admin ‚Ä¢ ‡ß¶ ‡¶≠‡¶ø‡¶â ‚Ä¢ Guide</p>
                            </div>
                        </div>
                    </div>`;
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        html += `
                        <div class="w-full pb-4 cursor-pointer" onclick="alert('‡¶ó‡¶≤‡ßç‡¶™‡¶ü‡¶ø ‡¶™‡ßú‡¶æ‡¶∞ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá!')">
                            <div class="poster-container" style="background-image: url('${data.poster || 'https://images.unsplash.com/photo-1516979187457-637abb4f9353?q=80&w=1000'}')">
                                <div class="video-time">‡¶ó‡¶≤‡ßç‡¶™</div>
                            </div>
                            <div class="flex gap-3 p-3">
                                <div class="w-10 h-10 bg-indigo-600 rounded-full flex-shrink-0 flex items-center justify-center font-bold uppercase">${(data.authorName || 'A')[0]}</div>
                                <div>
                                    <h3 class="font-bold text-[15px] leading-tight line-clamp-2">${data.title}</h3>
                                    <p class="text-[12px] text-gray-400 mt-1">${data.authorName || 'Writer'} ‚Ä¢ ${data.views || 0} ‡¶≠‡¶ø‡¶â ‚Ä¢ ${data.category}</p>
                                </div>
                            </div>
                        </div>`;
                    });
                }
                feed.innerHTML = html;
            }, (error) => {
                feed.innerHTML = `<div class="p-10 text-center text-red-500">‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ${error.message}</div>`;
            });
        };

        // Handle Upload
        window.handleUpload = async () => {
            const title = document.getElementById('story-title').value;
            const poster = document.getElementById('story-poster').value;
            const category = document.getElementById('story-category').value;
            const content = document.getElementById('story-content').value;
            const btn = document.getElementById('pub-btn');

            if (!title || !content) {
                alert("‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶ó‡¶≤‡ßç‡¶™ ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'stories'), {
                    title: title,
                    poster: poster,
                    category: category,
                    content: content,
                    authorName: auth.currentUser ? auth.currentUser.displayName : "Guest User",
                    views: 0,
                    createdAt: serverTimestamp()
                });
                alert("‡¶∏‡¶æ‡¶´‡¶≤‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                toggleUpload(false);
                // Clear fields
                document.getElementById('story-title').value = '';
                document.getElementById('story-poster').value = '';
                document.getElementById('story-content').value = '';
            } catch (e) {
                alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® üöÄ";
            }
        };

        // Auth Check
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('user-circle').innerText = user.displayName ? user.displayName[0] : 'U';
            }
            loadFeed(); // Always load feed
        });

    </script>
</body>
    </html>
