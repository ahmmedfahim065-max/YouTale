<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTale Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #070707; color: white; font-family: sans-serif; }
        .stat-card { background: #121212; border-radius: 15px; padding: 15px; text-align: center; border: 1px solid #222; }
        .edit-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; padding: 20px; }
    </style>
</head>
<body class="p-5">

    <div class="flex justify-between items-center mb-8">
        <button onclick="window.location.href='dashboard.html'" class="text-gray-400">‚Üê Home</button>
        <button onclick="openEdit()" class="bg-white/10 px-4 py-2 rounded-lg text-sm font-bold">Edit Profile</button>
    </div>

    <!-- Profile Header -->
    <div class="text-center">
        <div id="p-img" class="w-24 h-24 bg-red-600 rounded-full mx-auto mb-4 border-4 border-white/10 flex items-center justify-center text-3xl font-black">U</div>
        <h2 id="p-name" class="text-2xl font-black">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</h2>
        <p id="p-nik" class="text-gray-500 text-sm mt-1">@nickname</p>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-3 gap-3 mt-8">
        <div class="stat-card">
            <p id="s-followers" class="text-xl font-black">0</p>
            <p class="text-[10px] text-gray-500 uppercase font-bold mt-1">Followers</p>
        </div>
        <div class="stat-card">
            <p id="s-likes" class="text-xl font-black">0</p>
            <p class="text-[10px] text-gray-500 uppercase font-bold mt-1">Total Likes</p>
        </div>
        <div class="stat-card">
            <p id="s-stories" class="text-xl font-black">0</p>
            <p class="text-[10px] text-gray-500 uppercase font-bold mt-1">Stories</p>
        </div>
    </div>

    <!-- Withdrawal Button -->
    <button onclick="alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ß¶ ‡¶°‡¶≤‡¶æ‡¶∞ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§')" class="w-full bg-green-600/20 border border-green-600/50 py-4 rounded-xl mt-8 font-bold text-green-500">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ‡¶∞ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® üí∏</button>

    <!-- Edit Modal -->
    <div id="modal" class="edit-modal">
        <h2 class="text-2xl font-black mb-6 mt-10 text-red-600">Edit Profile</h2>
        <div class="space-y-4">
            <input type="text" id="edit-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ..." class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
            <input type="text" id="edit-nik" placeholder="‡¶®‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ (@)..." class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none">
            <button onclick="saveProfile()" class="w-full bg-red-600 py-4 rounded-xl font-black">SAVE CHANGES</button>
            <button onclick="closeEdit()" class="w-full text-gray-500 font-bold py-2">Cancel</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const config = JSON.parse(__firebase_config);
        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'YouTale-Pro-V1';

        onAuthStateChanged(auth, (user) => {
            if(user) loadProfile(user.uid);
        });

        async function loadProfile(uid) {
            const pRef = doc(db, 'artifacts', appId, 'users', uid, 'profile', 'data');
            onSnapshot(pRef, (snap) => {
                if(snap.exists()) {
                    const data = snap.data();
                    document.getElementById('p-name').innerText = data.name;
                    document.getElementById('p-nik').innerText = "@" + data.nickname;
                    document.getElementById('edit-name').value = data.name;
                    document.getElementById('edit-nik').value = data.nickname;
                    document.getElementById('p-img').innerText = data.name[0];
                }
            });
        }

        window.openEdit = () => document.getElementById('modal').style.display = 'block';
        window.closeEdit = () => document.getElementById('modal').style.display = 'none';

        window.saveProfile = async () => {
            const uid = auth.currentUser.uid;
            const name = document.getElementById('edit-name').value;
            const nickname = document.getElementById('edit-nik').value;
            
            await setDoc(doc(db, 'artifacts', appId, 'users', uid, 'profile', 'data'), {
                name, nickname, updatedAt: new Date()
            });
            closeEdit();
        };
    </script>
</body>
</html>
