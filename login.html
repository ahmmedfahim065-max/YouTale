<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTale - Join the World of Stories</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #1e1b4b);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            user-select: none;
            color: #f8fafc;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .glass-card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(25px); 
            border-radius: 2.5rem; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .brand-text {
            background: linear-gradient(to right, #818cf8, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        .input-box {
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: 0.3s;
        }
        .input-box:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: #818cf8;
            box-shadow: 0 0 15px rgba(129, 140, 248, 0.3);
        }
        .tab-btn { transition: 0.3s; position: relative; }
        .tab-btn.active { color: #818cf8; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -5px; left: 30%; width: 40%; height: 3px;
            background: #818cf8; border-radius: 10px;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body class="p-4">

    <!-- Loading Screen -->
    <div id="app-loader" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center">
        <div class="animate-pulse flex flex-col items-center">
            <h1 class="text-4xl brand-text mb-2">YouTale</h1>
            <div class="w-12 h-1 bg-indigo-500 rounded-full overflow-hidden">
                <div class="w-full h-full bg-pink-500 animate-ping"></div>
            </div>
        </div>
    </div>

    <div class="glass-card w-full max-w-md p-8 md:p-10 relative overflow-hidden">
        
        <!-- Top Guest Button -->
        <div class="flex justify-center mb-6">
            <button onclick="continueAsGuest()" class="px-6 py-2 rounded-full border border-indigo-400/30 text-indigo-300 text-xs font-bold uppercase tracking-widest hover:bg-indigo-500/10 transition-all">
                Continue as Guest üïµÔ∏è‚Äç‚ôÇÔ∏è
            </button>
        </div>

        <div class="text-center mb-8">
            <h2 class="text-5xl brand-text tracking-tighter mb-2">YouTale</h2>
            <p class="text-indigo-200/60 text-sm font-medium">Read ‚Ä¢ Write ‚Ä¢ Earn Global</p>
        </div>

        <!-- Tab Switching -->
        <div class="flex mb-8 border-b border-white/5">
            <button onclick="switchTab('login')" id="tab-login" class="flex-1 py-3 text-center font-bold text-gray-400 active">Sign In</button>
            <button onclick="switchTab('register')" id="tab-register" class="flex-1 py-3 text-center font-bold text-gray-400">Sign Up</button>
        </div>

        <!-- Login Form -->
        <div id="form-login" class="space-y-5">
            <input type="email" id="login-email" class="input-box w-full rounded-2xl py-4 px-6 outline-none" placeholder="Email Address">
            <input type="password" id="login-password" class="input-box w-full rounded-2xl py-4 px-6 outline-none" placeholder="Password">
            
            <div class="text-right">
                <button onclick="forgotPassword()" class="text-xs font-semibold text-indigo-400 hover:text-pink-400 transition-colors">Forgot Password?</button>
            </div>

            <button onclick="processLogin()" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-500 text-white rounded-2xl py-4 font-bold shadow-lg hover:shadow-indigo-500/20 active:scale-[0.98] transition-all">
                Sign In
            </button>
        </div>

        <!-- Register Form -->
        <div id="form-register" class="space-y-5 hidden">
            <input type="text" id="reg-name" class="input-box w-full rounded-2xl py-4 px-6 outline-none" placeholder="Full Name">
            <input type="email" id="reg-email" class="input-box w-full rounded-2xl py-4 px-6 outline-none" placeholder="Email Address">
            <input type="password" id="reg-password" class="input-box w-full rounded-2xl py-4 px-6 outline-none" placeholder="Password (6+ characters)">
            <button onclick="processRegister()" class="w-full bg-gradient-to-r from-pink-600 to-pink-500 text-white rounded-2xl py-4 font-bold shadow-lg active:scale-[0.98] transition-all">
                Create Account
            </button>
        </div>

        <div id="auth-message" class="mt-4 text-center text-xs font-bold p-3 rounded-xl hidden"></div>

        <div class="relative flex items-center my-8">
            <div class="flex-grow border-t border-white/10"></div>
            <span class="flex-shrink-0 mx-4 text-gray-500 text-[10px] font-bold uppercase tracking-widest">OR</span>
            <div class="flex-grow border-t border-white/10"></div>
        </div>

        <!-- Google Button -->
        <button onclick="loginWithGoogle()" class="w-full bg-white text-slate-900 rounded-2xl py-4 font-bold flex items-center justify-center gap-3 hover:bg-gray-100 active:scale-[0.98] transition-all">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-6 h-6">
            Continue with Google
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, GoogleAuthProvider, signInWithPopup, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB9WjFq4Ips9wMKoDmO8v2M6aZ2OxynQQo",
            authDomain: "youtale-f6845.firebaseapp.com",
            projectId: "youtale-f6845",
            storageBucket: "youtale-f6845.firebasestorage.app",
            messagingSenderId: "10854951568",
            appId: "1:10854951568:web:cffcc9813d858e130d8615"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();
        const appId = "YouTale-V10-Final";

        // ‡ßß. ‡¶Ö‡¶ü‡ßã-‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï (Session Persistence)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                window.location.href = "index.html"; 
            } else {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                document.getElementById('app-loader').classList.add('hidden');
            }
        });

        window.switchTab = (tab) => {
            const isLogin = tab === 'login';
            document.getElementById('form-login').classList.toggle('hidden', !isLogin);
            document.getElementById('form-register').classList.toggle('hidden', isLogin);
            document.getElementById('tab-login').classList.toggle('active', isLogin);
            document.getElementById('tab-register').classList.toggle('active', !isLogin);
        };

        window.processLogin = async () => {
            const e = document.getElementById('login-email').value, p = document.getElementById('login-password').value;
            if(!e || !p) return showMsg('Please fill all fields', true);
            try {
                showMsg('Authenticating...', false);
                await signInWithEmailAndPassword(auth, e, p);
            } catch(err) { showMsg('Incorrect email or password', true); }
        };

        window.processRegister = async () => {
            const n = document.getElementById('reg-name').value, e = document.getElementById('reg-email').value, p = document.getElementById('reg-password').value;
            if(!n || !e || p.length < 6) return showMsg('Invalid info (Password 6+ chars)', true);
            try {
                showMsg('Creating account...', false);
                const cred = await createUserWithEmailAndPassword(auth, e, p);
                await updateProfile(cred.user, { displayName: n });
                await setDoc(doc(db, 'artifacts', appId, 'users', cred.user.uid, 'profile'), {
                    name: n, email: e, role: 'user', balance: 0, joinedAt: new Date().toISOString()
                });
            } catch(err) { showMsg('Email already in use or error occurred', true); }
        };

        window.forgotPassword = async () => {
            const email = document.getElementById('login-email').value;
            if(!email) return showMsg('Enter your email in the box first', true);
            try {
                await sendPasswordResetEmail(auth, email);
                showMsg('Reset link sent to your email!', false);
            } catch(err) { showMsg('Could not send reset link', true); }
        };

        window.loginWithGoogle = async () => {
            try {
                const res = await signInWithPopup(auth, googleProvider);
                const user = res.user;
                const userRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile');
                const docSnap = await getDoc(userRef);
                if (!docSnap.exists()) {
                    await setDoc(userRef, { name: user.displayName, email: user.email, role: 'user', balance: 0, joinedAt: new Date().toISOString() });
                }
            } catch(err) { showMsg('Google sign-in failed', true); }
        };

        window.continueAsGuest = () => { 
            localStorage.setItem('youtale_guest', 'true'); 
            window.location.href = "index.html"; 
        };

        function showMsg(m, isE) {
            const box = document.getElementById('auth-message');
            box.innerText = m; box.className = `mt-4 text-center text-xs font-bold p-3 rounded-xl ${isE ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}`;
            box.classList.remove('hidden');
        }
    </script>
</body>
</html>
